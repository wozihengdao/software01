<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/axios-0.18.0.js"></script>
    <script src="js/vue.js"></script>
    <script src="element-ui/lib/index.js"></script>
    <link rel="stylesheet" href="element-ui/lib/theme-chalk/index.css">
</head>
<body>


<div id="app">

    <el-container>
        <el-aside width="200px" style="background-color: rgb(238, 241, 246)" style="height:  1000px">
            <el-menu
                    @select="handleMenuItemClick" background-color="#545c64"
                    text-color="#fff"
                    active-text-color="#ffd04b" >
                    <template slot="title"><i class="el-icon-message"></i>导航一</template>
                    <el-menu-item-group>
<!--                        <template slot="title"></template>-->
                        <el-menu-item index="1">个人信息</el-menu-item>
                        <el-menu-item index="2">功能栏</el-menu-item>
                        <el-menu-item index="3">联系我们</el-menu-item>
                        <el-menu-item index="4">退出登录</el-menu-item>
                    </el-menu-item-group>

            </el-menu>
        </el-aside>


        <el-container>
            <div v-if="activeIndex1==2" style="width:1500px">
            <el-header>

                <el-menu
                        :default-active="activeIndex2"
                        class="el-menu-demo"
                        mode="horizontal"
                        @select="handleSelect"
                        background-color="#545c64"
                        text-color="#fff"
                        active-text-color="#ffd04b"

                >

                    <el-menu-item index="1">首页</el-menu-item>
                    <el-menu-item index="2">报修</el-menu-item>
                    <el-menu-item index="3">维修</el-menu-item>
                    <el-menu-item index="4">保养</el-menu-item>
                    <el-menu-item index="5">巡检</el-menu-item>
                    <el-menu-item index="6">检测</el-menu-item>
                    <el-menu-item index="7">备件</el-menu-item>
                </el-menu>

            </el-header>
            <el-main>

                    <!--按钮-->

                    <el-row>

                        <!--         <el-button type="danger" @click="multiDelete()" plain>批量删除</el-button>-->
                        <el-button type="primary" plain @click="dialogVisible = true">报修</el-button>

                    </el-row>


                    <!--添加数据对话框表单-->
                    <el-dialog
                            title="报修工单"
                            :visible.sync="dialogVisible"
                            width="40%">
                        <el-form ref="form" :model="repairOrder" label-width="120px">
                            <!-- 隐藏ID字段 -->
                            <el-input type="hidden" v-model="repairOrder.id"></el-input>

                            <el-form-item label="所属车站" prop="stop" required>
                                <el-select
                                        v-model="repairOrder.stop"
                                        placeholder="请选择车站"
                                        filterable>
                                    <el-option
                                            v-for="station in stationList"
                                            :key="station.id"
                                            :label="station.name"
                                            :value="station.id">
                                    </el-option>
                                </el-select>
                            </el-form-item>

                            <el-form-item label="设备编号" prop="faultyEquipmentId" required>
                                <el-input
                                        v-model="repairOrder.faultyEquipmentId"
                                        placeholder="请输入设备编号或扫码">

                                </el-input>
                            </el-form-item>

                            <el-form-item label="故障类别" prop="faultyType">
                                <el-select v-model="repairOrder.faultyType" placeholder="请选择类型">
                                    <el-option label="机械故障" value="mechanical"></el-option>
                                    <el-option label="电气故障" value="electrical"></el-option>
                                    <el-option label="软件故障" value="software"></el-option>
                                </el-select>
                            </el-form-item>

                            <el-form-item label="故障等级" prop="faultyGrade">
                                <el-radio-group v-model="repairOrder.faultyGrade">
                                    <el-radio label="urgent">紧急</el-radio>
                                    <el-radio label="high">高</el-radio>
                                    <el-radio label="medium">中</el-radio>
                                    <el-radio label="low">低</el-radio>
                                </el-radio-group>
                            </el-form-item>

                            <el-form-item label="故障描述" prop="faultyDescription">
                                <el-input
                                        type="textarea"
                                        :rows="3"
                                        v-model="repairOrder.faultyDescription"
                                        placeholder="请详细描述故障现象">
                                </el-input>
                            </el-form-item>
                           <span>上传图片</span>
                            <el-upload

                                    ref="upload"
                                    action="#"
                                    file-list="fileList"
                                    list-type="picture-card"
                                    :auto-upload="false">
                                <i slot="default" class="el-icon-plus"></i>
                                            <div slot="file" slot-scope="{file}">
                                                <img
                                                        class="el-upload-list__item-thumbnail"
                                                        :src="file.url" alt=""
                                                >
                                                <span class="el-upload-list__item-actions">
                    <span
                            class="el-upload-list__item-preview"
                            @click="handlePictureCardPreview(file)"
                    >
                      <i class="el-icon-zoom-in"></i>
                    </span>
                    <span
                            v-if="!disabled"
                            class="el-upload-list__item-delete"
                            @click="handleDownload(file)"
                    >
                      <i class="el-icon-download"></i>
                    </span>
                    <span
                            v-if="!disabled"
                            class="el-upload-list__item-delete"
                            @click="handleRemove(file)"
                    >
                      <i class="el-icon-delete"></i>
                    </span>
                  </span>
                                            </div>
                            </el-upload>



                            <el-form-item>
                                <el-button type="primary" @click="submitRepairOrder">提交工单</el-button>
                                <el-button @click="dialogVisible = false">取消</el-button>
                            </el-form-item>
                        </el-form>
                    </el-dialog>


                    <!--表格-->
                    <template>
                        <el-table
                                :data="tableData"
                                style="width: 100%"
                                :row-class-name="tableRowClassName"
                                @selection-change="handleSelectionChange"
                        >
                            <el-table-column prop="id" label="报修单号" align="center"></el-table-column>
                            <el-table-column prop="stop" label="所属车站" align="center"></el-table-column>
                            <el-table-column prop="faultyEquipmentId" label="故障设备编号" align="center"></el-table-column>
                            <el-table-column prop="faultyType" label="故障类别" align="center"></el-table-column>
                            <el-table-column prop="type" label="状态" align="center"></el-table-column>
                            <el-table-column prop="data" label="上报时间" align="center"></el-table-column>


                            <el-table-column
                                    fixed="right"
                                    label="操作"
                                    width="120">

                                <template slot-scope="scope">
                                    <el-button
                                            @click.native.prevent="deleteItem(scope.$index, tableData)"
                                            type="text"
                                            size="small">
                                        撤回
                                    </el-button>

                                    <el-button

                                            type="text"
                                            size="small"
                                            @click="initItem(scope.$index)">
                                        修改
                                    </el-button>


                                </template>

                            </el-table-column>

                        </el-table>
                    </template>






            </el-main>

            </div>
        </el-container>
    </el-container>

            {{activeIndex1}}



</div>


</body>
<script>
    new Vue({
        el:"#app",
        data() {
            return {
                repairOrderList:[],
                activeIndex1: '2',
                activeIndex2: '2',
                dialogVisible:false,
                repairOrder:{},
                dialogImageUrl: '',
                stationList:[],
                disabled: false,
                tableData:[]
            };
        },
        mounted() {

            axios.post("http://localhost:7469/MaintenanceManage/stop/selectAll",).then((res) => {

                this.stationList = res.data;

            })

        axios.post("http://localhost:7469/MaintenanceManage/repairOrder/selectAll",).then((res) => {

            this.tableData= res.data;

        })
    }
        ,
        methods: {
            handleSelect(key, keyPath) {

                window.location.href = "http://localhost:7469/MaintenanceManage/0"+(key-1)+".html";

            },
            handleMenuItemClick(index) {
                console.log('点击菜单:', index)
               this.activeIndex1=index;
                alert(activeIndex1);
            },
            fileList: [],
            handleRemove(file) {
                // 从上传文件列表中移除
                const fileList = this.$refs.upload.uploadFiles;
                this.$refs.upload.uploadFiles = fileList.filter(item => item.uid !== file.uid);
            },
            handlePictureCardPreview(file) {
                this.dialogImageUrl = file.url;
                this.dialogVisible = true;
            },
            handleDownload(file) {
                console.log(file);
            },

            submitRepairOrder(){

                axios.post("http://localhost:7469/MaintenanceManage/repairOrder/insert",this.repairOrder).then((res) => {

                            alert("hello");

                })
                this.dialogVisible=false;
            }
        }
        }
    )
</script>
</html>