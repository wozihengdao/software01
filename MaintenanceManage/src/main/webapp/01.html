<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/axios-0.18.0.js"></script>
    <script src="js/vue.js"></script>
    <script src="element-ui/lib/index.js"></script>
    <link rel="stylesheet" href="element-ui/lib/theme-chalk/index.css">
    <script src="js/storage.js"></script>
</head>
<body>

<style scoped>
    .info-item {
        margin: 8px 28px;
        line-height: 15px;
    }

    .info-label {
        color: #909399;
        margin-right: 10px;
    }

    .info-content {
        color: #606266;
    }

    .image {
        width: 100%;
        height: 270px;
        object-fit: cover;
        display: block;
    }

    .button {
        width: 100%;
        margin-top: 5px;
    }
</style>


<div id="app">

    <el-container>
        <el-aside width="200px" style="background-color: #545c64; height: 100vh">
            <el-menu
                    :default-active="activeIndex1"
                    @select="handleMenuItemClick"
                    background-color="#545c64"
                    text-color="#fff"
                    active-text-color="#ffd04b">
                <el-menu-item-group title="主菜单">
                    <el-menu-item index="1">
                        <i class="el-icon-user"></i>
                        <span>个人信息</span>
                    </el-menu-item>
                    <el-menu-item index="2">
                        <i class="el-icon-menu"></i>
                        <span>功能面板</span>
                    </el-menu-item>
                    <el-menu-item index="3">
                        <i class="el-icon-phone"></i>
                        <span>联系我们</span>
                    </el-menu-item>
                    <el-menu-item index="4">
                        <i class="el-icon-switch-button"></i>
                        <span>退出登录</span>
                    </el-menu-item>
                </el-menu-item-group>
            </el-menu>
        </el-aside>


        <el-container>
            <div v-if="activeIndex1==2" style="width:1500px">
                <el-header>

                    <el-menu
                            :default-active="activeIndex2"
                            class="el-menu-demo"
                            mode="horizontal"
                            @select="handleSelect"
                            background-color="#545c64"
                            text-color="#fff"
                            active-text-color="#ffd04b"

                    >

                        <el-menu-item index="1">首页</el-menu-item>
                        <el-menu-item index="2">报修</el-menu-item>
                        <el-menu-item index="3">维修</el-menu-item>
                        <el-menu-item index="4">保养</el-menu-item>
                        <el-menu-item index="5">巡检</el-menu-item>
                        <el-menu-item index="6">检测</el-menu-item>
                        <el-menu-item index="7">备件</el-menu-item>
                    </el-menu>

                </el-header>
                <el-main>


                        <!--按钮-->

                        <el-row>

                            <!--         <el-button type="danger" @click="multiDelete()" plain>批量删除</el-button>-->
                            <el-button type="primary" plain @click="dialogVisible = true">报修</el-button>

                        </el-row>


                        <!--添加数据对话框表单-->
                        <el-dialog
                                title="报修工单"
                                :visible.sync="dialogVisible"
                                width="40%">
                            <el-form ref="form" :model="repairOrder" label-width="120px">
                                <!-- 隐藏ID字段 -->
                                <el-input type="hidden" v-model="repairOrder.id"></el-input>

                                <el-form-item label="所属车站" prop="stop" required>
                                    <el-select
                                            v-model="repairOrder.stop"
                                            placeholder="请选择车站"
                                            filterable>
                                        <el-option
                                                v-for="station in stationList"
                                                :key="station.id"
                                                :label="station.name"
                                                :value="station.name">
                                        </el-option>
                                    </el-select>
                                </el-form-item>

                                <el-form-item label="设备编号" prop="faultyEquipmentId" required>
                                    <el-input
                                            v-model="repairOrder.faultyEquipmentId"
                                            placeholder="请输入设备编号">

                                    </el-input>
                                </el-form-item>

                                <el-form-item label="故障类别" prop="faultyType">
                                    <el-select v-model="repairOrder.faultyType" placeholder="请选择类型">
                                        <el-option label="机械故障" value="mechanical"></el-option>
                                        <el-option label="电气故障" value="electrical"></el-option>
                                        <el-option label="软件故障" value="software"></el-option>
                                    </el-select>
                                </el-form-item>

                                <el-form-item label="故障等级" prop="faultyGrade">
                                    <el-radio-group v-model="repairOrder.faultyGrade">
                                        <el-radio label="urgent">紧急</el-radio>
                                        <el-radio label="high">高</el-radio>
                                        <el-radio label="medium">中</el-radio>
                                        <el-radio label="low">低</el-radio>
                                    </el-radio-group>
                                </el-form-item>

                                <el-form-item label="故障描述" prop="faultyDescription">
                                    <el-input
                                            type="textarea"
                                            :rows="3"
                                            v-model="repairOrder.faultyDescription"
                                            placeholder="请详细描述故障现象">
                                    </el-input>
                                </el-form-item>
                                <span>上传图片</span>
                                <el-upload

                                        ref="upload"
                                        action="#"
                                        file-list="fileList"
                                        list-type="picture-card"
                                        :auto-upload="false">
                                    <i slot="default" class="el-icon-plus"></i>
                                    <div slot="file" slot-scope="{file}">
                                        <img
                                                class="el-upload-list__item-thumbnail"
                                                :src="file.url" alt=""
                                        >
                                        <span class="el-upload-list__item-actions">
                    <span
                            class="el-upload-list__item-preview"
                            @click="handlePictureCardPreview(file)"
                    >
                      <i class="el-icon-zoom-in"></i>
                    </span>
                    <span
                            v-if="!disabled"
                            class="el-upload-list__item-delete"
                            @click="handleDownload(file)"
                    >
                      <i class="el-icon-download"></i>
                    </span>
                    <span
                            v-if="!disabled"
                            class="el-upload-list__item-delete"
                            @click="handleRemove(file)"
                    >
                      <i class="el-icon-delete"></i>
                    </span>
                  </span>
                                    </div>
                                </el-upload>



                                <el-form-item>
                                    <el-button type="primary" @click="submitRepairOrder">提交工单</el-button>
                                    <el-button @click="dialogVisible = false">取消</el-button>
                                </el-form-item>
                            </el-form>
                        </el-dialog>



                    <!--添加数据对话框表单-->
                    <!-- 报修工单详情对话框 -->
                    <el-dialog
                            title="报修工单"
                            :visible.sync="dialogVisible1"
                            width="40%">
                        <el-form
                                :model="repairOrder"
                                label-position="right"
                                label-width="120px"
                                style="padding: 0 20px">

                            <!-- 第一行 -->
                            <el-row>
                                <el-col :span="12">
                                    <el-form-item label="工单ID：">
                                        <el-input v-model="repairOrder.id" readonly></el-input>
                                    </el-form-item>
                                </el-col>
                                <el-col :span="12">
                                    <el-form-item label="停机情况：">
                                        <el-input v-model="repairOrder.stop" readonly></el-input>
                                    </el-form-item>
                                </el-col>
                            </el-row>

                            <!-- 第二行 -->
                            <el-row>
                                <el-col :span="12">
                                    <el-form-item label="设备编号：">
                                        <el-input v-model="repairOrder.faultyEquipmentId" readonly></el-input>
                                    </el-form-item>
                                </el-col>
                                <el-col :span="12">
                                    <el-form-item label="故障类型：">
                                        <el-input v-model="repairOrder.faultyType" readonly></el-input>
                                    </el-form-item>
                                </el-col>
                            </el-row>

                            <!-- 第三行 -->
                            <el-row>
                                <el-col :span="12">
                                    <el-form-item label="严重等级：">
                                        <el-input v-model="repairOrder.faultyGrade" readonly></el-input>
                                    </el-form-item>
                                </el-col>
                                <el-col :span="12">
                                    <el-form-item label="工单类型：">
                                        <el-input v-model="repairOrder.type" readonly></el-input>
                                    </el-form-item>
                                </el-col>
                            </el-row>

                            <!-- 故障描述 -->
                            <el-form-item label="故障描述：">
                                <el-input
                                        type="textarea"
                                        :rows="3"
                                        v-model="repairOrder.faultyDescription"
                                        readonly>
                                </el-input>
                            </el-form-item>

                            <!-- 现场图片 -->
                            <el-form-item label="现场图片：">
                                <img
                                        v-if="repairOrder.picture"
                                        :src="repairOrder.picture"
                                        style="max-width: 100%; max-height: 200px"
                                        alt="现场图片">
                                <span v-else style="color: #999">暂无图片</span>
                            </el-form-item>

                            <!-- 补充数据 -->
                            <el-form-item label="补充数据：">
                                <pre style="background: #f5f7fa; padding: 10px">{{ repairOrder.data }}</pre>
                            </el-form-item>
                        </el-form>
                    </el-dialog>



                        <!--表格-->
                    <el-table
                            :data="currentPageData"
                            style="width: 100%"
                            :row-class-name="tableRowClassName"
                            @selection-change="handleSelectionChange">


                                <el-table-column prop="id" label="报修单号" align="center"></el-table-column>
                                <el-table-column prop="stop" label="所属车站" align="center"></el-table-column>
                                <el-table-column prop="faultyEquipmentId" label="故障设备编号" align="center"></el-table-column>
                                <el-table-column prop="faultyType" label="故障类别" align="center"></el-table-column>
                                <el-table-column label="状态" align="center">
                                    <template #default="scope">
                                        <el-tag :type="statusStyle[scope.row.type]" size="medium">
                                            {{ statusText[scope.row.type] }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="data" label="上报时间" align="center"></el-table-column>


                                <el-table-column
                                        fixed="right"
                                        label="操作"
                                        width="120">

                                    <template slot-scope="scope">



                                            <el-button

                                                    type="primary"
                                                    size="small"
                                                    @click="initItem(scope.$index)">
                                                详细
                                            </el-button>
                                        </template>



                                </el-table-column>

                            </el-table>
                        </template>
<<<<<<< HEAD
=======

                    <el-pagination
                            background
                            :current-page="currentPage"
                            :page-size="pageSize"
                            :total="tableData.length"
                            layout="prev, pager, next"
                            @current-change="handleCurrentChange">
                    </el-pagination>




>>>>>>> 453dc911a51acfdef70cc13ca2ae187aec0d0705
                </el-main>

            </div>
        </el-container>
    </el-container>

</div>
</body>

<script>
    new Vue({
            el:"#app",

        computed: {
            statusText() {
                return { 0: '待处理', 1: '进行中', 2: '已完成', 3: '已关闭' };
            },
            statusStyle() {
                return { 0: 'warning', 1: 'primary', 2: 'success', 3: 'info' };
            },
            currentPageData() {
                const start = (this.currentPage - 1) * this.pageSize;
                const end = start + this.pageSize;
                return this.tableData.slice(start, end);
            }
        },
            data() {
                return {
                    currentPage: 1,  // 当前页码
                    pageSize: 10,
                    repairOrderList:[],
                    activeIndex1: '2',
                    activeIndex2: '2',
                    dialogVisible:false,
                    dialogVisible1:false,
                    repairOrder:{},
                    dialogImageUrl: '',
                    stationList:[],
                    disabled: false,
                    tableData:[]
                };
            },
            mounted() {

                axios.post("http://localhost:7469/MaintenanceManage/stop/selectAll",).then((res) => {

                    this.stationList = res.data;

                })

                axios.post("http://localhost:7469/MaintenanceManage/repairOrder/selectAll",).then((res) => {

                    this.tableData= res.data;

                })
            }
            ,
            methods: {

                initItem(order){

                    this.repairOrder=order;

                    this.dialogVisible1 = true;
                },
                handleCurrentChange(newPage) {
                    this.currentPage = newPage;
                },
                deleteItem(order){

                        this.$confirm('确认要接受该维修单吗？', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        }).then(() => {
                            // 调用API更新工程师ID

                            axios.post("http://localhost:7469/MaintenanceManage/repairOrder/delete", order).then((res) => {

                            })
                            this.$message.success('撤回成功');
                             window.location.reload();
                        })
                }


                /** 状态显示配置 */
   ,
    handleSelect(key, keyPath) {

                    this.activeIndex2 = key;
                    window.location.href = "http://localhost:7469/MaintenanceManage/0"+(key-1)+".html";
                    console.log(key, keyPath);
                },
                handleMenuItemClick(index) {
                    console.log('点击菜单:', index)
                    this.activeIndex1=index;
                    if(index==1){
                        window.location.href = "http://localhost:7469/MaintenanceManage/000.html";
                    }
                    else if(index==2){

                        window.location.href = "http://localhost:7469/MaintenanceManage/01.html";
                    }
                    else if(index==3){

                        window.location.href = "http://localhost:7469/MaintenanceManage/002.html";
                    }
                    else if(index==4){
                        window.location.href = "http://localhost:7469/MaintenanceManage/logIn.html";


                    }},
                fileList: [],
                handleRemove(file) {
                    // 从上传文件列表中移除
                    const fileList = this.$refs.upload.uploadFiles;
                    this.$refs.upload.uploadFiles = fileList.filter(item => item.uid !== file.uid);
                },
                handlePictureCardPreview(file) {
                    this.dialogImageUrl = file.url;
                    this.dialogVisible = true;
                },
                handleDownload(file) {
                    console.log(file);
                },

                submitRepairOrder(){

                    axios.post("http://localhost:7469/MaintenanceManage/repairOrder/insert",this.repairOrder).then((res) => {

                        this.dialogVisible=false;

                    })
<<<<<<< HEAD

=======
                    this.dialogVisible=false;

                   window.location.reload();
>>>>>>> 453dc911a51acfdef70cc13ca2ae187aec0d0705
                }
            }
        }
    )
</script>

</html>